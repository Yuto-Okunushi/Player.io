<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>動物ボタン</title>
</head>
<body>
  <h1>動物ボタンでAWS WebSocket通信</h1>
  <button onclick="send(1)">カバ</button>
  <button onclick="send(2)">ウサギ</button>
  <button onclick="send(3)">モモンガ</button>
  <button onclick="send(4)">ニホンザル</button>

  <script>
    // ✅ WebSocketサーバーのURL（Nginx経由、SSL対応済み）
    const WS_URL = "wss://ws.dcsaitolab.com";

    // ✅ グローバルな WebSocket 変数
    let socket;

    // WebSocket接続処理
    function connectWebSocket() {
      socket = new WebSocket(WS_URL);

      socket.onopen = () => {
        console.log("✅ WebSocket接続完了");
      };

      socket.onerror = (error) => {
        console.error("❌ WebSocketエラー:", error);
      };

      socket.onmessage = (event) => {
        console.log("📩 サーバーから受信:", event.data);
      };

      socket.onclose = (event) => {
        console.warn("⚠️ WebSocket接続が閉じられました。コード:", event.code, "理由:", event.reason);
      };
    }

    // データ送信関数
    function send(value) {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(value.toString());
        console.log("📤 送信:", value);
      } else {
        console.warn("⛔ WebSocketが未接続。再接続を試みます...");
        connectWebSocket();
        // 送信は再接続後に別途行う必要あり（即送信は不可）
      }
    }

    // ページ読み込み時に接続
    window.onload = () => {
      connectWebSocket();
    };

    // ページ離脱時に切断
    window.onbeforeunload = () => {
      if (socket) {
        socket.close();
      }
    };
  </script>
</body>
</html>
