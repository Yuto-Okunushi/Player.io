<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>動物ボタン</title>
</head>
<body>
  <h1>動物ボタンでAWS WebSocket通信</h1>
  <button onclick="send(1)">カバ</button>
  <button onclick="send(2)">ウサギ</button>
  <button onclick="send(3)">モモンガ</button>
  <button onclick="send(4)">ニホンザル</button>

  <script>
    // WebSocketサーバーのURL（ws:// か wss://を適宜変更してください）
    // ※SSL証明書を設定していなければws://、設定済みならwss://にしてください
    const WS_URL = "wss://ec2-3-27-119-133.ap-northeast-1.compute.amazonaws.com:8080";

    let socket;

    function connectWebSocket() {
      socket = new WebSocket(WS_URL);

      socket.onopen = () => {
        console.log("WebSocket接続完了");
      };

      socket.onerror = (error) => {
        console.error("WebSocketエラー:", error);
      };

      socket.onmessage = (event) => {
        console.log("サーバーから受信:", event.data);
      };

      socket.onclose = (event) => {
        console.warn("WebSocket接続が閉じられました。コード:", event.code, "理由:", event.reason);
        // 必要なら再接続処理をここに書く
      };
    }

    function send(value) {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(value.toString());
        console.log("送信:", value);
      } else {
        console.warn("WebSocketが接続されていません。再接続を試みます...");
        connectWebSocket();
        // 再接続後に送信する場合はタイミングをずらす必要があります（ここでは省略）
      }
    }

    // ページ読み込み時にWebSocket接続開始
    window.onload = () => {
      connectWebSocket();
    };

    // ページ離脱時にWebSocketを閉じる
    window.onbeforeunload = () => {
      if (socket) {
        socket.close();
      }
    };
  </script>
</body>
</html>
